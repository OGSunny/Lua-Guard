<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Lua Guard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            min-height: 100vh;
            color: #fff;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 50px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .logo { font-size: 1.5rem; font-weight: bold; }
        .logo a { color: #fff; text-decoration: none; }
        .logo span { color: #5865F2; }
        .admin-badge { background: #ED4245; padding: 3px 10px; border-radius: 5px; font-size: 0.8rem; margin-left: 10px; }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { color: #888; text-decoration: none; }
        .nav-links a:hover, .nav-links a.active { color: #fff; }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .header { margin-bottom: 40px; }
        .header h1 { font-size: 2rem; margin-bottom: 10px; }
        .header p { color: #888; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        .stat-card h3 { font-size: 2.5rem; margin-bottom: 5px; }
        .stat-card p { color: #888; }
        .stat-card.blue h3 { color: #5865F2; }
        .stat-card.green h3 { color: #57F287; }
        .stat-card.yellow h3 { color: #FEE75C; }
        .stat-card.red h3 { color: #ED4245; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }
        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            font-size: 1rem;
        }
        .tab:hover { color: #fff; }
        .tab.active { background: rgba(88,101,242,0.1); color: #5865F2; }
        .card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }
        .card h2 { margin-bottom: 20px; font-size: 1.3rem; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { color: #888; font-weight: 600; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; }
        .badge-success { background: rgba(87,242,135,0.1); color: #57F287; }
        .badge-danger { background: rgba(237,66,69,0.1); color: #ED4245; }
        .badge-primary { background: rgba(88,101,242,0.1); color: #5865F2; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #888; }
        .form-group input {
            width: 100%;
            padding: 12px;
            background: #12121a;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }
        .form-group input:focus { outline: none; border-color: #5865F2; }
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }
        .btn-primary { background: #5865F2; color: #fff; }
        .btn-primary:hover { background: #4752C4; }
        .btn-success { background: #57F287; color: #000; }
        .btn-danger { background: #ED4245; color: #fff; }
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #12121a;
            border: 1px solid #57F287;
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
        }
        .toast.show { display: block; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <a href="/">üõ°Ô∏è <span>Lua</span> Guard</a>
            <span class="admin-badge">ADMIN</span>
        </div>
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/dashboard.html">Dashboard</a>
            <a href="/admin.html" class="active">Admin</a>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è Admin Panel</h1>
            <p>Manage users, keys, and settings</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card blue">
                <h3 id="total-users">0</h3>
                <p>Total Users</p>
            </div>
            <div class="stat-card green">
                <h3 id="total-keys">0</h3>
                <p>Total Keys</p>
            </div>
            <div class="stat-card yellow">
                <h3 id="active-keys">0</h3>
                <p>Active Keys</p>
            </div>
            <div class="stat-card red">
                <h3 id="banned-users">0</h3>
                <p>Banned Users</p>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('users')">üë• Users</button>
            <button class="tab" onclick="showTab('keys')">üîë Keys</button>
            <button class="tab" onclick="showTab('settings')">‚öôÔ∏è Settings</button>
        </div>

        <!-- Users Tab -->
        <div class="tab-content active" id="users-tab">
            <div class="card">
                <h2>üë• User Management</h2>
                <table>
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Discord ID</th>
                            <th>Joined</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="users-table">
                        <tr><td colspan="4" style="text-align:center;color:#888;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Keys Tab -->
        <div class="tab-content" id="keys-tab">
            <div class="card">
                <h2>üîë Key Management</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>HWID</th>
                            <th>Created</th>
                            <th>Expires</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="keys-table">
                        <tr><td colspan="5" style="text-align:center;color:#888;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings-tab">
            <div class="settings-grid">
                <div class="card">
                    <h2>üîó Linkvertise Settings</h2>
                    <div class="form-group">
                        <label>Publisher ID</label>
                        <input type="text" id="lv-publisher" placeholder="Enter Publisher ID">
                    </div>
                    <div class="form-group">
                        <label>Anti-Bypass Token</label>
                        <input type="password" id="lv-token" placeholder="Enter Token">
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings('linkvertise')">üíæ Save</button>
                </div>
                <div class="card">
                    <h2>üéÆ LootLabs Settings</h2>
                    <div class="form-group">
                        <label>Publisher ID</label>
                        <input type="text" id="ll-publisher" placeholder="Enter Publisher ID">
                    </div>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="ll-apikey" placeholder="Enter API Key">
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings('lootlabs')">üíæ Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const API = '/api';
        
        // Load stats
        async function loadStats() {
            try {
                const res = await fetch(API + '?route=admin/stats');
                const data = await res.json();
                if (data.success) {
                    document.getElementById('total-users').textContent = data.stats.totalUsers;
                    document.getElementById('total-keys').textContent = data.stats.totalKeys;
                    document.getElementById('active-keys').textContent = data.stats.activeKeys;
                    document.getElementById('banned-users').textContent = data.stats.bannedUsers;
                }
            } catch (e) { console.error(e); }
        }
        
        // Load users
        async function loadUsers() {
            try {
                const res = await fetch(API + '?route=admin/users');
                const data = await res.json();
                if (data.success) {
                    const tbody = document.getElementById('users-table');
                    if (data.users.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#888;">No users yet</td></tr>';
                    } else {
                        tbody.innerHTML = data.users.map(u => `
                            <tr>
                                <td>${u.username || 'Unknown'}</td>
                                <td><code>${u.discord_id}</code></td>
                                <td>${u.joined_at ? new Date(u.joined_at).toLocaleDateString() : '-'}</td>
                                <td>
                                    ${u.is_banned ? '<span class="badge badge-danger">Banned</span>' : 
                                      u.is_admin ? '<span class="badge badge-primary">Admin</span>' : 
                                      '<span class="badge badge-success">Active</span>'}
                                </td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (e) { console.error(e); }
        }
        
        // Load keys
        async function loadKeys() {
            try {
                const res = await fetch(API + '?route=admin/keys');
                const data = await res.json();
                if (data.success) {
                    const tbody = document.getElementById('keys-table');
                    if (data.keys.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#888;">No keys yet</td></tr>';
                    } else {
                        tbody.innerHTML = data.keys.map(k => `
                            <tr>
                                <td><code>${k.key.substring(0, 15)}...</code></td>
                                <td><code>${k.hwid}</code></td>
                                <td>${new Date(k.created_at).toLocaleDateString()}</td>
                                <td>${new Date(k.expires_at).toLocaleDateString()}</td>
                                <td><span class="badge ${k.is_active ? 'badge-success' : 'badge-danger'}">${k.is_active ? 'Active' : 'Expired'}</span></td>
                            </tr>
                        `).join('');
                    }
                }
            } catch (e) { console.error(e); }
        }
        
        // Load settings
        async function loadSettings() {
            try {
                const res = await fetch(API + '?route=admin/settings');
                const data = await res.json();
                if (data.success) {
                    document.getElementById('lv-publisher').value = data.settings.linkvertise?.publisher_id || '';
                    document.getElementById('ll-publisher').value = data.settings.lootlabs?.publisher_id || '';
                }
            } catch (e) { console.error(e); }
        }
        
        // Save settings
        async function saveSettings(type) {
            let body = { integration_type: type };
            
            if (type === 'linkvertise') {
                body.publisher_id = document.getElementById('lv-publisher').value;
                body.anti_bypass_token = document.getElementById('lv-token').value;
            } else {
                body.publisher_id = document.getElementById('ll-publisher').value;
                body.api_key = document.getElementById('ll-apikey').value;
            }
            
            try {
                const res = await fetch(API + '?route=admin/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                const data = await res.json();
                showToast(data.success ? 'Settings saved!' : 'Failed to save');
            } catch (e) {
                showToast('Error saving settings');
            }
        }
        
        // Show tab
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
        }
        
        // Toast
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        // Load all
        loadStats();
        loadUsers();
        loadKeys();
        loadSettings();
    </script>
</body>
</html>
